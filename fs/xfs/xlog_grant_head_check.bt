#!/usr/bin/env bpftrace
/**
 *	Tracing XFS xlog_grant_head_check
 *	Rong Tao 2021.12.16
 */

BEGIN
{
	printf("Tracing XFS xlog calls... Hit Ctrl-C to end.\n");
	printf("%-8s %-8s %-16s ", "TIME", "PID", "COMM");
	printf("%-16s\n", "NEED BYTES");
}

kprobe:xlog_grant_head_check
{
	$pneed_bytes = arg3;
	
	time("%H:%M:%S ");
    printf("%-8d %-16s ", pid, comm);
	printf("%-16d\n", *$pneed_bytes);
}

END 
{
}
